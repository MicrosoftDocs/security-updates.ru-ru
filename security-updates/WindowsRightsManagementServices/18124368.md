---
TOCTitle: Создание списков отзыва
Title: Создание списков отзыва
ms:assetid: '1ef75199-3344-4225-84de-a863a777696a'
ms:contentKeyID: 18124368
ms:mtpsurl: 'https://technet.microsoft.com/ru-ru/library/Cc720208(v=WS.10)'
---

Создание списков отзыва
=======================

Для выполнения отзыва требуется развернуть список отзывов, который является XML-документом, использующим язык XrML. В нем перечислены участники, которым запрещен доступ к содержимому, защищенному правами. Необходимо создать списки отзыва с установленными отметками времени, а также соответствующим образом подписанные с помощью средства подписывания списка отзыва (RLsigner.exe), которое предоставляется службой управления правами.

| ![](/security-updates/images/Cc720208.Important(WS.10).gif)Важно!                                                 |
|------------------------------------------------------------------------------------------------------------------------------|
| Чтобы подписать список отзыва с помощью средства RLsigner.exe, файл со списком отзыва необходимо сохранить в формате Юникод. |

Пример списка отзыва
--------------------

В этом разделе рассматривается пример полного списка отзыва с описанием всех возможных механизмов выполнения отзыва. Этот пример можно использовать в качестве модели для создания собственных списков отзыва.

Список отзыва — это XML-файл, в котором используется язык XrML.

В элементе BODY содержатся четыре дочерних элемента.

-   **ISSUEDTIME**. Содержится дата и время выпуска списка отзыва. Программа RLsigner.exe вставляет данный элемент в файл; этот элемент представлен в примере только для того, чтобы продемонстрировать общую структуру файла со списком отзыва.
-   **DESCRIPTOR**. Содержатся данные, идентифицирующие файл как список отзыва.
-   **ISSUER**. Содержатся данные, идентифицирующие объект, выдавший список отзыва.
-   **REVOCATIONLIST**. Содержатся дочерние элементы REVOKE, в которых указываются объекты, отзываемые этим списком.

Ниже представлен пример файла со списком отзыва.

| ![](/security-updates/images/Cc720208.note(WS.10).gif)Примечание                                                      |
|----------------------------------------------------------------------------------------------------------------------------------|
        ```
| ![](/security-updates/images/Cc720208.Caution(WS.10).gif)Внимание!                                                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| При указании URL-адреса в списке отзыва UNC-путь больше не поддерживается в службе управления правами с пакетом обновления 1 (SP1) или 2 (SP2). Необходимо использовать URL-адрес. |

После того как элементы REVOKE определены, список отзывов готов для подписи.

Использование элемента REVOKE
-----------------------------

В примере списка отзыва в разделе "Пример списка отзыва" каждый элемент REVOKE указывает участника, который должен быть отозван. Открывающий тег содержит атрибуты категории и типа, которые определяют, что отзывается и по какому определяющему критерию. Различные элементы REVOKE содержат разные дочерние элементы в зависимости от действия, которое указывается атрибутами категории и типа.

Дополнительные сведения об указании элементов REVOKE можно найти в следующих примерах:

-   [Отзыв участников на основе открытого ключа](#bkmk_1)
-   [Отзыв сертификатов и лицензий на основе кода GUID](#bkmk_2)
-   [Отзыв сертификатов и лицензий на основе значения хэш-кода](#bkmk_3)
-   [Отзыв сертификатов и лицензий на основе открытого ключа поставщика](#bkmk_4)
-   [Отзыв сертификатов и лицензий на основе кода поставщика](#bkmk_5)
-   [Отзыв содержимого на основе кода содержимого](#bkmk_6)
-   [Отзыв сертификатов на основе кода участников](#bkmk_10)
-   [Отзыв участников на основе Windows Live ID](#bkmk_7)

<span id="BKMK_1"></span>
#### Отзыв участников на основе открытого ключа

        ```

<span id="BKMK_2"></span>
#### Отзыв сертификатов и лицензий на основе кода GUID

        ```
#### Отзыв по манифесту приложения

Для отзыва по манифесту приложения нужно извлечь из него код поставщика, открытый ключ поставщика, код или хэш-код лицензии. Однако манифесты приложения имеют кодировку Base64, так что просмотреть информацию в простом тексте нельзя. С помощью SDK службы управления правами можно разработать программу, использующую для декодирования манифеста приложения и получения нужных сведений методы DRMConstructCertificateChain, DRMDeconstructCertificateChain и DRMDecode.

Если нужно запретить некоторым приложениям использовать защищенное содержимое рекомендуется применить исключение приложений, чтобы запретить кластеру службы управления правами предоставлять таким приложениям лицензии на использование. Ограничение, накладываемое на исключение, состоит в том, что исключение не может предотвратить расшифровку содержимого, защищенного правами, кем-либо, имеющим действительную лицензию на использование. Дополнительные сведения об исключении приложений см. в разделе [Исключение приложений](https://technet.microsoft.com/b68ae4b2-b9ba-44ae-90cb-c88df600ec86) данного документа.

<span id="BKMK_3"></span>
#### Отзыв сертификатов и лицензий на основе значения хэш-кода

        ```
#### Отзыв по манифесту приложения

Для отзыва по манифесту приложения нужно извлечь из него код поставщика, открытый ключ поставщика, код или хэш-код лицензии. Однако в манифестах приложения используется кодировка Base64, поэтому информацию недоступна в виде простого текста. С помощью SDK службы управления правами можно разработать программу, использующую методы DRMConstructCertificateChain, DRMDeconstructCertificateChain и DRMDecode для декодирования манифеста приложения и получения нужных сведений.

Если нужно запретить некоторым приложениям использовать защищенное содержимое рекомендуется применить исключение приложений, чтобы запретить кластеру службы управления правами предоставлять таким приложениям лицензии на использование. Ограничение, накладываемое на исключение, состоит в том, что исключение не может предотвратить расшифровку содержимого, защищенного с помощью управления правами, кем-либо, имеющим действительную лицензию на использование. Дополнительные сведения об исключении приложений см. в разделе [Исключение приложений](https://technet.microsoft.com/b68ae4b2-b9ba-44ae-90cb-c88df600ec86) данного документа.

<span id="BKMK_4"></span>
#### Отзыв сертификатов и лицензий на основе открытого ключа поставщика

        ```

<span id="BKMK_5"></span>
#### Отзыв сертификатов и лицензий на основе кода поставщика

        ```
| ![](/security-updates/images/Cc720208.note(WS.10).gif)Примечание                                                                                                                                                                                   |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Указывая тип ID, убедитесь, что между глобально уникальным идентификатором (GUID) и закрывающим тегом нет символа возврата каретки. При случайном добавлении символа возврата каретки клиент службы управления правами не сможет анализировать список отзыва. |

<span id="BKMK_6"></span>
#### Отзыв содержимого на основе идентификатора содержимого

        ```
| ![](/security-updates/images/Cc720208.note(WS.10).gif)Примечание                                                                                                                                                                                               |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Указывая тип идентификатора, убедитесь, что между глобально уникальным идентификатором (GUID) и закрывающим тегом нет символа возврата каретки. При случайном добавлении символа возврата каретки клиент службы управления правами не сможет анализировать список отзыва. |

<span id="BKMK_10"></span>
#### Отзыв участников на основе учетной записи Windows

        ```
| ![](/security-updates/images/Cc720208.note(WS.10).gif)Примечание                                                                                                                                                                                          |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Указывая тип идентификатора, убедитесь, что между ИД безопасности учетной записи Windows и закрывающим тегом нет символа возврата каретки. При случайном добавлении символа возврата каретки клиент службы управления правами не сможет анализировать список отзыва. |

<span id="BKMK_7"></span>
#### Отзыв участников на основе Windows Live ID

        ```
| ![](/security-updates/images/Cc720208.note(WS.10).gif)Примечание                                                                                                                                                                                                       |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Указывая тип идентификатора, убедитесь, что между главным глобально уникальным идентификатором (GUID) и закрывающим тегом нет символа возврата каретки. При случайном добавлении символа возврата каретки клиент службы управления правами не сможет анализировать список отзыва. |

<span id="BKMK_8"></span>
Вставка подписи в список отзыва
-------------------------------

По окончании создания списка отзывов необходимо вставить в него подпись, как описано в этом материале. Затем список отзыва необходимо сделать доступным для пользователей с помощью URL-адреса, который указывается в соответствующем шаблоне политики прав.

Создание пары ключей и файла ключа для списка отзыва с помощью средства Strong Name (Sn.exe) — это первый шаг вставки подписи. Средство Sn.exe включено в комплект Microsoft .NET Framework SDK 1.1, доступный на веб-узле корпорации Майкрософт [http://go.microsoft.com/fwlink/?LinkId=104796](http://go.microsoft.com/fwlink/?linkid=104796).

Файл со списком отзыва должен быть сохранен в формате Юникод, чтобы его можно было подписать с помощью программы RLsigner.exe.

**Использование Sn.exe для создания новой пары ключей и записи ее в файл**
1.  Создайте закрытый ключ. В командной строке введите указанный ниже текст и нажмите клавишу ВВОД:

    **sn -k** *файл\_закрытого\_ключа***.snk**

    где *файл\_закрытого\_ключа* — имя файла ключа.

2.  С помощью программы Sn.exe извлеките открытый ключ из файла пары ключей, созданного на шаге 1, и экспортируйте его в отдельный файл. Введите указанную ниже команду и нажмите клавишу ВВОД.

    **sn -p** *файл\_закрытого\_ключа файл\_открытого\_ключа*

    где *файл\_закрытого\_ключа* — имя файла закрытого ключа, созданного на шаге 1, а *файл\_открытого\_ключа* — имя файла, в котором будет сохранен экспортируемый открытый ключ.

3.  Измените расширение имени файла закрытого ключа (созданного на шаге 1) с .snk на .dat, чтобы использовать с программой RLsigner.exe.

4.  С помощью программы RLsigner.exe вставьте подпись в файл со списком отзыва. Это средство входит в комплект службы управления правами. По умолчанию эта программа располагается в папке %systemdrive%\\Program Files\\Windows Rights Management Services\\Tools.

| ![](/security-updates/images/Cc720208.note(WS.10).gif)Примечание          |
|--------------------------------------------------------------------------------------|
| Средством RLsigner.exe не поддерживаются файлы, в именах которых содержатся пробелы. |

<span id="BKMK_9"></span>
Использование RLsigner.exe
--------------------------

При запуске RLsigner.exe данная программа сначала создает подпись с помощью закрытого ключа, который предоставляется в соответствующем файле ключа. Затем она создает выходной файл на основе предоставленного файла списка отзывов.

| ![](/security-updates/images/Cc720208.Important(WS.10).gif)Важно!                 |
|----------------------------------------------------------------------------------------------|
| Для использования RLsigner.exe файл со списком отзыва должен быть сохранен в формате Юникод. |

Чтобы подписать список отзыва с помощью программы RLsigner.exe, введите в командной строке следующую команду:

**rlsigner.exe***input\_file***{-f***key\_file* **| -h** *container\_name***CSP}***output\_file*

Для ввода входных параметров команды пользуйтесь следующими сведениями.

###  

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th style="border:1px solid black;" >Параметр</th>
<th style="border:1px solid black;" >Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="border:1px solid black;"><em>input_file</em></td>
<td style="border:1px solid black;">Имя XrML-совместимого файла с подготовленным списком отзыва.</td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><em>key_file</em></td>
<td style="border:1px solid black;">Имя файла, содержащего открытый и секретный ключи, которые уже созданы.</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;"><em>container_name</em></td>
<td style="border:1px solid black;">Имя контейнера ключа</td>
</tr>
<tr class="even">
<td style="border:1px solid black;"><em>output_file</em></td>
<td style="border:1px solid black;">Имя подписанного файла со списком отзыва, который будет создан данным средством.</td>
</tr>
</tbody>
</table>
  
| ![](/security-updates/images/Cc720208.note(WS.10).gif)Примечание          |  
|--------------------------------------------------------------------------------------|  
| Средством RLsigner.exe не поддерживаются файлы, в именах которых содержатся пробелы. |
  
В следующих примерах описывается, как можно использовать RLsigner.exe в командной строке с разными поставщиками службы криптографии.
  
-   Пример синтаксиса команды, в которой используется файл ключа:  
    **rlsigner.exe rl.xml -f key.dat output.xml**  
-   Пример синтаксиса команды, в которой используется аппаратный модуль безопасности:  
    **rlsigner.exe rl.xml -h Container CSP output.xml**
  
Средство RLsigner.exe в коде возврата предоставляет основные сведения об ошибках и успешно выполненных операциях. В следующей таблице описываются возможные коды возврата.
  
###  

 
<table style="border:1px solid black;">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th style="border:1px solid black;" >Код возврата</th>
<th style="border:1px solid black;" >Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="border:1px solid black;">0</td>
<td style="border:1px solid black;">Удачное завершение</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">-1</td>
<td style="border:1px solid black;">Не удается прочесть исходный файл</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;">-2</td>
<td style="border:1px solid black;">Не удается прочесть файл ключа</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">-3</td>
<td style="border:1px solid black;">Неверный файл ключа</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;">-4</td>
<td style="border:1px solid black;">Неверный исходный файл</td>
</tr>
<tr class="even">
<td style="border:1px solid black;">-5</td>
<td style="border:1px solid black;">Не удается записать выходной файл</td>
</tr>
<tr class="odd">
<td style="border:1px solid black;">-6</td>
<td style="border:1px solid black;">Неизвестная ошибка</td>
</tr>
</tbody>
</table>
  
Существует возможность планирования подписывания списков отзыва на основе периода обновления, указанного для сервера.
  
Процесс подписывания списка отзыва можно автоматизировать путем создания сценария. В следующем примере сценарий VBScript вызывает программу RLsigner.exe и записывает результаты в журнал системных событий.
  
<codesnippet asp="http://msdn2.microsoft.com/asp" language displaylanguage="Visual Basic">const EVT\_SUCCESS = 0 const EVT\_ERROR = 1 const EVT\_WARNING = 2 const EVT\_INFORMATION = 4 const EVT\_AUDIT\_SUCCESS = 8 const EVT\_AUDIT\_FAILURE = 16 Dim WshShell, oExec Set WshShell = CreateObject( "WScript.Shell" ) Set oExec = WshShell.Exec("rlsigner.exe input\_file key\_file output\_file") Do While oExec.Status = 0 WScript.Sleep 100 Loop if WshShell.ExitCode &lt;&gt; 0 Then WshShell.LogEvent EVT\_ERROR, "RLsigner failed with error """ + WshShell.ExitCode + """" else WshShell.LogEvent EVT\_SUCCESS, "RLsigner completed successfully" end if  
```
